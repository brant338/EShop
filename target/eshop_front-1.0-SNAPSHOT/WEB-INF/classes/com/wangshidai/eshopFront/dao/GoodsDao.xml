<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
根标签mapper，一个映射配置文件，就对应一个dao接口
根标签的namespace属性的值就对应dao接口的全限定名
-->
<mapper namespace="com.wangshidai.eshopFront.dao.GoodsDao">

    <select id="findGoodType" parameterType="String" resultType="TypeInfo">
        select * from tb_type where parent_id = #{rootTypeId}
    </select>

    <select id="findGoodOne" parameterType="int" resultType="GoodsInfo">
        select * from tb_book where book_id = #{book_id}
    </select>

    <select id="findGoodPic" parameterType="int" resultType="GoodPicInfo">
        select * from tb_book_pic where book_id = #{book_id}
    </select>

    <select id="findGood" parameterType="map" resultType="GoodsInfo">
        <if test="type_id != null and type_id != ''">
            <if test="keyword == null or keyword == ''">
                <if test="child_type_id != null and child_type_id != ''">
                    select * from tb_book where type_id = #{child_type_id}
                </if>
                <if test="child_type_id == null or child_type_id == ''">
                    select * from tb_book where type_id = #{type_id}
                    or type_id in (select type_id from tb_type where parent_id = #{type_id})
                </if>
            </if>
            <if test="keyword != null and keyword != ''">
                select * from tb_book
                where (type_id = #{type_id} or type_id in (select type_id from tb_type where parent_id = #{type_id}))
                and (book_name like "%"#{keyword}"%" or book_author like "%"#{keyword}"%" or book_press like "%"#{keyword}"%")
                order by book_id
            </if>
        </if>
        <if test="type_id == null or type_id == ''">
            select * from tb_book
            where book_name like "%"#{keyword}"%" or book_author like "%"#{keyword}"%" or book_press like "%"#{keyword}"%"
            order by book_id
        </if>
        limit #{startIndex},#{pageInfo.pageSize}
    </select>

    <select id="findGoodCount" parameterType="map" resultType="int">
        <if test="type_id != null and type_id != ''">
            <if test="keyword == null or keyword == ''">
                <if test="child_type_id != null and child_type_id != ''">
                    select count(*) from tb_book where type_id = #{child_type_id}
                </if>
                <if test="child_type_id == null or child_type_id == ''">
                    select count(*) from tb_book where type_id = #{type_id}
                    or type_id in (select type_id from tb_type where parent_id = #{type_id})
                </if>
            </if>
            <if test="keyword != null and keyword != ''">
                select count(*) from tb_book
                where (type_id = #{type_id} or type_id in (select type_id from tb_type where parent_id = #{type_id}))
                and (book_name like "%"#{keyword}"%" or book_author like "%"#{keyword}"%" or book_press like "%"#{keyword}"%")
                order by book_id
            </if>
        </if>
        <if test="type_id == null or type_id == ''">
            select count(*) from tb_book
            where book_name like "%"#{keyword}"%" or book_author like "%"#{keyword}"%" or book_press like "%"#{keyword}"%"
            order by book_id
        </if>
    </select>

</mapper>